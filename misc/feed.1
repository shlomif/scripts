.Dd December 12 2016
.Dt FEED 1
.nh
.Os
.Sh NAME
.Nm feed
.Nd feeds commands into a REPL
.Sh SYNOPSIS
.Nm feed
.Ar file|-
.Ar command
.Op Ar command-args ..
.Ek
.Sh DESCRIPTION
.Nm
reads lines from the given
.Pa file
(or standard input) and feeds these lines to the subsequent
.Ar command ,
Once all the lines have been fed, the user will be able to
.Ic interact
with the REPL manually.
.Pp
Support for a REPL should ideally be written into the code. See the
code for the supported REPL and default behavior, as for some commands
some lines (comments, blank lines) may be skipped, prompts may be
waited for, etc.
.Pp
Input of
.Ic control+z
will cause
.Nm
(and the
.Ar command )
to stop. A
.Ic control+c
will be relayed from
.Nm
to the 
.Ar command .
.Sh EXIT STATUS
.Ex -std
The exit status once
.Nm
has begun to
.Ic interact
with the given
.Ar command
will likely always be 0 (regardless how the
.Ar command
exits), unless a
.Dv HUP ,
.Dv PIPE ,
or
.Dv TERM
signal is sent.
.Sh EXAMPLES
From a 
.Xr vi 1
buffer containing LISP code, one could issue
.Pp
.Dl Ic :!feed % sbcl --noinform
.Pp
to feed the contents of the buffer to
.Pa sbcl .
Standard input is also supported as a source of input,
.Pp
.Dl $ Ic echo run -al \&| feed - gdb -q ls
.Pp
would run
.Pa ls
under
.Pa gdb
and then launch
.Pa ls
with the arguments
.Ar -al 
and then turn
.Pa gdb
over to the user. From an editor, one may use a
.Pa fooprog.gdb
file containing whatever GDB commands are necessary, e.g.
.Pp
.Dl shell make fooprog
.Dl set args some args
.Dl file ./fooprog
.Dl break somecall
.Dl commands
.Dl silent
.Dl watch somevarinsomecall
.Dl continue
.Dl end
.Dl run
.Pp
and then set your editor to feed this to
.Nm .
With
.Xr vim 1 ,
an appropriate mapping might look something like
.Pp
.Dl map <Leader>t :!feed % gdb -q<CR><CR>
.Pp
.Nm
assisted the design and debugging of the ZSH completion script for
.Nm ;
given a
.Pa vi
buffer containing
.Pp
.Dl rm ~/.zcompdump
.Dl fpath=(~/co/zsh/compdef $fpath)
.Dl autoload -U compinit && compinit
.Dl # fake completion on ls as want to see if complete its arguments
.Dl zstyle ':completion:*:*:feed:*:commands' fake-always ls
.Dl zstyle ':completion:*:*:feed:*:commands' ignored-patterns '*'
.Dl # stdin completion testing
.Dl #print -z 'echo foo | feed '
.Dl print -z 'feed '
.Pp
one can then feed a test shell invocation with these commands via
.Pp
.Dl Ic :!feed % zsh -f
.Pp
and then try out the tab completion (edited elsewhere) until it works. The
.Ar -f
to
.Pa zsh
prevents anything in the regular shell configuration from interfering
with the task at hand, though do note that undesirable environment
variables may be passed through from the parent process.
.Sh SEE ALSO
.Xr expect 1 ,
.Xr Tcl n ,
.Xr vim 1 ,
.Xr zcomppoke 1
.Sh AUTHOR
.An Jeremy Mates
.Sh CAVEATS
The history may need to be disabled for the REPL, as repeated
.Nm
runs may spam the history for the REPL with repeated entries.
